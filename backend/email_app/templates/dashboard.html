<!DOCTYPE html>
<html>
<head>
    <title>Talking Mail Box - Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f6fa;
            margin: 0;
            padding: 0;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #6B73FF;
            color: #fff;
            padding: 1rem 2rem;
        }
        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .profile-icon svg {
            width: 28px;
            height: 28px;
        }
        .signout-btn {
            background: #fff;
            color: #6B73FF;
            border: none;
            border-radius: 20px;
            padding: 0.5rem 1.2rem;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
        }
        .dashboard-center {
            max-width: 600px;
            margin: 3rem auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
            padding: 2rem 2.5rem;
            text-align: center;
        }
        .email-actions {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-top: 2rem;
        }
        .email-action {
            background: #f0f2ff;
            border: none;
            border-radius: 8px;
            padding: 1rem;
            font-size: 1.1rem;
            color: #333;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .voice-status {
            margin-top: 2rem;
            font-size: 1rem;
            color: #6B73FF;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="profile-icon">
            <!-- Simple SVG profile icon -->
            <svg viewBox="0 0 24 24" fill="#6B73FF">
                <circle cx="12" cy="8" r="4"/>
                <ellipse cx="12" cy="17" rx="7" ry="4"/>
            </svg>
        </div>
        <button class="signout-btn" onclick="window.location.href='{% url 'logout' %}'">Sign Out</button>
    </div>
    <div class="dashboard-center">
        <h2>Welcome, {{ request.user.email }}</h2>
        <div class="email-actions">
            <button class="email-action" disabled>Inbox</button>
            <button class="email-action" disabled>Sent Mail</button>
            <button class="email-action" disabled>Compose Email</button>
            <button class="email-action" disabled>Drafts</button>
            <button class="email-action" disabled>Trash</button>
            <button class="email-action" disabled>Starred</button>
            <button class="email-action" disabled>Search Mail</button>
        </div>
        <div class="voice-status" id="voiceStatus">
            Voice system ready. Say a command like "Open Inbox", "Compose Email", or "Sign Out".
        </div>
    </div>
    <script>
        // Voice command system
        const synth = window.speechSynthesis;
        const voiceStatus = document.getElementById('voiceStatus');
        let recognition = null;

        function speak(text, callback) {
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.rate = 1;
            utter.pitch = 1;
            utter.onend = () => { if (callback) callback(); };
            synth.speak(utter);
            voiceStatus.textContent = text;
        }

        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                voiceStatus.textContent = "Voice commands not supported in your browser.";
                return;
            }
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = true;
            recognition.interimResults = false;
            recognition.maxAlternatives = 3;

            recognition.onresult = (event) => {
                const results = event.results[event.results.length - 1];
                let command = results[0].transcript.trim().toLowerCase();
                console.log("[User] Command:", command);

                // Voice command routing
                if (command.includes("inbox")) {
                    speak("Opening Inbox.", () => { window.location.href = "{% url 'inbox' %}"; });
                } else if (command.includes("sent")) {
                    speak("Opening Sent Mail.", () => { window.location.href = "{% url 'sent' %}"; });
                } else if (command.includes("compose")) {
                    speak("Opening Compose Email.", () => { window.location.href = "{% url 'compose' %}"; });
                } else if (command.includes("draft")) {
                    speak("Opening Drafts.", () => { window.location.href = "{% url 'drafts' %}"; });
                } else if (command.includes("trash")) {
                    speak("Opening Trash.", () => { window.location.href = "{% url 'trash' %}"; });
                } else if (command.includes("starred")) {
                    speak("Opening Starred.", () => { window.location.href = "{% url 'starred' %}"; });
                } else if (command.includes("search")) {
                    speak("Say your search query.", () => {
                        recognition.stop();
                        startSearchRecognition();
                    });
                } else if (command.includes("sign out") || command.includes("logout")) {
                    speak("Signing out.", () => { window.location.href = "{% url 'logout' %}"; });
                } else {
                    speak("Sorry, I didn't understand. Please say a command like Open Inbox, Compose Email, or Sign Out.");
                }
            };

            recognition.onerror = (event) => {
                speak("Voice recognition error. Please try again.");
            };

            recognition.start();
        }

        function startSearchRecognition() {
            let searchRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            searchRecognition.continuous = false;
            searchRecognition.interimResults = false;
            searchRecognition.maxAlternatives = 3;

            searchRecognition.onresult = (event) => {
                const query = event.results[0][0].transcript.trim();
                speak(`Searching for ${query}.`, () => {
                    // Redirect to search page with query (implement this URL in Django)
                    window.location.href = "{% url 'search' %}?q=" + encodeURIComponent(query);
                });
            };
            searchRecognition.onerror = () => {
                speak("Sorry, I didn't catch that. Returning to dashboard.", startVoiceRecognition);
            };
            searchRecognition.onend = startVoiceRecognition;
            searchRecognition.start();
        }

        window.onload = function() {
    const user = "{{ request.user.email }}";

    speak(`Welcome to your dashboard, ${user}.`, () => {
        speak("You can say commands like Open Inbox, Compose Email, Open Sent Mail, Open Drafts, or Sign Out.", () => {
            speak("Say your command after this message.", startVoiceRecognition);
        });
    });
        };
    </script>
</body>
</html>